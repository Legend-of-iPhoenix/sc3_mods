'use strict';let f={};class g{constructor(a,b,e,d){console.log('Loaded Mod "'+b+'"');d=d||0;this.name=b;this.a=e;this.type=d;if(!(d%2)){e=document.getElementById("sc3_mods");let c=document.createElement("button");c.classList.add("sc3_interface_button");2==d?(this.c=!1,c.onclick=()=>{this.a(this.c);this.c=!this.c}):c.onclick=this.a;c.innerText=b;e.appendChild(c)}f[a]=this}}
{let a=document.getElementById("proj_buttons"),b=document.createElement("div");b.classList.add("project_pane");b.id="sc3_mods";a.appendChild(b)}let h=document.getElementById("tokenize_result");h.style.boxSizing="border-box";h.style.margin="0";let k=document.createElement("div");k.style.padding="4px";h.parentNode.insertBefore(k,h);k.appendChild(h);new g("autosave_shifting_disable","Toggle Autosave Shifting",a=>{k.style.minHeight=a?"":"37px"},2);
new g("format_basic_ice","Format TI-BASIC and ICE",(a,b)=>{const e="spaces"==sc3_settings.indent_type?" ".repeat(sc3_settings.indent_width):"\t";let d=0;return a.map(c=>{c=c.trimStart();(c.startsWith("End")||c.startsWith("Else"))&&d--;let n=c;d&&(n=e.repeat(d)+c);"ICETokens"==b&&c.startsWith("If")&&d++;(c.startsWith("Then")||c.startsWith("While")||c.startsWith("Repeat")||c.startsWith("For(")||c.startsWith("Else"))&&d++;return n})},1);
new g("format","Format Code",()=>{let a=proj.files[proj.f],b=a.g,e=a.data.split("\n");switch(b){case "84+CSE":case "Tokens":case "ICETokens":a.data=f.format_basic_ice.a(e,b).join("\n");proj.loadToPage(proj.f);proj.refreshProjectPane();break;default:$.b({type:"error",icon:"/sc/img/64x64_error.png",title:"Current file type not supported",content:"Currently, I only support formatting TI-BASIC and ICE programs."})}});
new g("fullscreen_toggle","Toggle Fullscreen",a=>{"#user_tools_parent #sidebar_parent #sc3_container>div.gradient_edge #sc3_columns>.jstified_edge #sc3_columns>.jstified_edge2 #sc3_columns>.jstified_shutter".split(" ").map(e=>{document.querySelector(e).style.display=a?"":"none"});let b=document.querySelector("#page_content_parent");b.style.width=a?"":"100%";b.style.overflow=a?"":"initial";document.querySelector("#content_wrapper").style.maxWidth=a?"80rem":""},2);
new g("local_save","Save Project Locally",()=>{try{localStorage.setItem("proj",JSON.stringify(proj))}catch(a){console.error(a);setEdMsgBad("There was an error saving your project locally.");return}setEdMsgOK("Saved local copy of project successfully.")});
new g("local_load","Load Local Project",()=>{let a=void 0;try{a=JSON.parse(localStorage.getItem("proj"))}catch(b){$.b({type:"error",icon:"/sc/img/64x64_error.png",title:"Failed to read data from local storage.",content:"Your data may have been invalid, erased, or too large."});return}null==a?$.b({type:"error",icon:"/sc/img/64x64_error.png",content:"No local save was found."}):f.parse_text.a(a)&&setEdMsgOK("Loaded local copy of project successfully.")});
new g("export_text","Export Project as Text",()=>{createTextDialog(JSON.stringify(proj),!0)});
new g("parse_text","Text Parser",a=>{try{let b=proj.files.length;for(let e=0;e<b;e++){let d=a.files[e];if(d){let c=new sc3_file(d.type,d.g);Object.assign(c,d);a.files[e]=c}else delete a.files[e]}}catch(b){return console.error(b),$.b({type:"error",icon:"/sc/img/64x64_error.png",title:"Failed to load project from text",content:"The data was formatted improperly."}),!1}proj=new sc3_proj;Object.assign(proj,a);proj.loadToPage(proj.f);proj.refreshProjectPane();return!0},1);
new g("load_text","Import Project from Text",()=>{let a=prompt("Paste the text here. \n THIS WILL OVERWRITE YOUR CURRENT PROJECT");null==a?$.b({type:"error",icon:"/sc/img/64x64_error.png",title:"No text inputted.",content:""}):(a=JSON.parse(a),f.parse_text.a(a)&&setEdMsgOK("Loaded project from text successfully!"))});let l={default:!0,h:!0},m=document.createElement("select");m.name="theme";
m.innerHTML="neat default 3024-day 3024-night abcdef ambiance base16-dark base16-light bespin blackboard cobalt colorforth darcula dracula duotone-dark duotone-light eclipse elegant erlang-dark gruvbox-dark hopscotch icecoder idea isotope lesser-dark liquibyte lucario material material-darker material-palenight material-ocean mbo mdn-like midnight monokai moxer neo night nord oceanic-next panda-syntax paraiso-dark paraiso-light pastel-on-dark railscasts rubyblue seti shadowfox solarized the-matrix tomorrow-night-bright tomorrow-night-eighties ttcn twilight vibrant-ink xq-dark xq-light yeti yonce zenburn".split(" ").map(a=>"<option>"+
a+"</option>").join("\n");let p=document.createElement("label");p.for="theme";p.innerText="Theme: ";m.oninput=a=>{a=a.target.value;if(!l[a]){let b=document.createElement("link");b.rel="stylesheet";b.href="https://codemirror.net/theme/"+a+".css";document.body.appendChild(b);l[a]=!0}myCodeMirror.i("theme",a)};let q=document.getElementById("sc3_mods");q.appendChild(p);q.appendChild(m);
